function ConnectFourNotification(e,r){var n=this;n.message=e,n.extraClass=r||"secondary"}function ConnectFourCell(e,r,n){var a=this;a.x=e,a.y=r,a.value=ko.observable(n),a.valueForCSS=ko.computed(function(){var e=a.value(),r=null;switch(e){case 1:r="p1";break;case 2:r="p2";break;default:r="empty"}return"cell-"+r})}function ConnectFourColumn(e){var r=this;r.rows=e}function ConnectFourRow(e){var r=this;r.columns=e}function ConnectFourGame(e,r){var n=this;n.id=e,n.grid=[];var a=0,t=0,o=null;for(a=0;a<r.length;a++){for(o=[],t=0;t<r[a].length;t++)o.push(new ConnectFourCell(a,t,r[a][t]));n.grid.push(o)}n.asRows=function(){for(var e=_.zip.apply(_,n.grid),r=[],a=0;a<e.length;a++)r.push(new ConnectFourRow(e[a]));return r},n.serializedGrid=function(){var e=0,r=0,a=null,t=[];for(e=0;e<n.grid.length;e++){for(a=[],r=0;r<n.grid[e].length;r++)a.push(n.grid[e][r].value());t.push(a)}return t},n.isWon=function(){var e=n.serializedGrid();if(containsStreakOfValues(e))return!0;var r=_.zip.apply(_,e);if(containsStreakOfValues(r))return!0;for(var a=0;a<e.length;a++)for(var t=e[a].length-1;t>=0;t--){var o=e[a][t];if(null!==o&&searchDiagonally(a,t,e))return!0}return!1}}function ConnectFourViewModel(){var e=this;e.currentNotifications=ko.observableArray([]),e.loadGameId=ko.observable(null),e.currentGame=ko.observable(null),e.currentPlayer=ko.observable(null),e.gameWinner=ko.observable(null),e.currentGameRows=ko.computed(function(){return null===e.currentGame()?[]:e.currentGame().asRows()}),e.playerOneName=ko.observable(null),e.playerTwoName=ko.observable(null),e.currentPlayerName=ko.computed(function(){switch(e.currentPlayer()){case 1:return e.playerOneName();case 2:return e.playerTwoName();default:return null}}),e.displayTimedNotification=function(r,n){var a=new ConnectFourNotification(r,n);e.currentNotifications.push(a),setTimeout(function(){e.currentNotifications.destroy(a)},5e3)},e.showLoading=function(){$("body").css({opacity:.7})},e.hideLoading=function(){$("body").css({opacity:1})},e.selectCell=function(r){if(e.gameWinner())return void e.displayTimedNotification("Game is over. Please quit this game and start a new one.","alert");var n=e.currentGame(),a=r.x,t=r.y;if(1===e.currentPlayer())var o="checker-p2";else var o="checker-p1";for(var i=!1,u=n.grid[a],l=u.length-1;l>=0;l--)if(!u[l].value()){u[l].value(e.currentPlayer()),i=!0;break}if(!i)return void e.displayTimedNotification("Invalid move. Please try again.","alert");var c=e.currentGame().isWon();if(c)return void e.gameWinner(e.currentPlayer());$(".animate").removeClass("checker-p1 checker-p2").addClass(o);var s=e.currentPlayer()%2+1;e.currentPlayer(s),$("#grid ul[data-checkerbatch="+t+"] .animate[data-cell="+a+"]").addClass("down")},e.startNewGame=function(){var r={url:"/new",dataType:"json",success:function(r,n,a){e.hideLoading(),e.currentGame(new ConnectFourGame(r.id,r.data)),e.currentPlayer(1)},error:function(r,n,a){e.hideLoading(),e.currentGame(null),e.displayTimedNotification("Error creating new game!","alert")}};$.ajax(r),e.showLoading()},e.quitGame=function(){e.currentGame(null),e.currentNotifications.removeAll(),e.currentPlayer(null),e.gameWinner(null)},e.saveGame=function(){var r=e.currentGame().serializedGrid(),n={url:"/"+e.currentGame().id,type:"POST",data:JSON.stringify(r),contentType:"application/json",success:function(r,n,a){e.displayTimedNotification("Saved ID '"+e.currentGame().id+"'","success")},error:function(r,n,a){e.displayTimedNotification("Error saving game: "+r.responseJSON.msg,"alert")}};$.ajax(n)},e.loadGame=function(){var r=e.loadGameId(),n={url:"/"+r,dataType:"json",success:function(n,a,t){e.hideLoading(),e.currentGame(new ConnectFourGame(r,n.data)),e.displayTimedNotification("Loaded '"+r+"'","success"),e.currentPlayer(1)},error:function(r,n,a){e.hideLoading(),e.currentGame(null),e.displayTimedNotification("Error loading game: "+r.responseJSON.msg,"alert")}};$.ajax(n),e.showLoading()}}